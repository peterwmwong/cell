// Generated by CoffeeScript 1.4.0

define(['util/hash', 'cell/Model', 'cell/Collection'], function(hash, Model, Collection) {
  var onChange;
  onChange = function() {
    try {
      this.cb(this.expr());
    } catch (_error) {}
  };
  return {
    watch: function(expr, cb) {
      var accesslog, m, modelHashKey, p, value;
      Model._spy.start();
      try {
        value = expr();
      } catch (_error) {}
      accesslog = Model._spy.stop();
      for (modelHashKey in accesslog) {
        m = accesslog[modelHashKey];
        for (p in m.props) {
          m.model.on("change:" + p, onChange, {
            expr: expr,
            cb: cb
          });
        }
      }
      cb(value);
    }
  };
});
